{% extends "base.html" %}

{% block title %}Editar Usuário - CRAS App{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Editar Usuário</h2>

    <form action="{{ url_for('editar_usuario', nome_usuario=usuario['nome']) }}" method="POST" class="needs-validation" novalidate>
        <!-- Nome -->
        <div class="mb-4">
            <label for="nome" class="form-label">Nome:</label>
            <input type="text" class="form-control form-control-lg" id="nome" name="nome" value="{{ usuario['nome'] }}" required style="text-transform: uppercase;">
            <div class="invalid-feedback">Por favor, insira o nome.</div>
        </div>

        <!-- Data de Nascimento -->
        <div class="mb-4">
            <label for="data_nascimento" class="form-label">Data de Nascimento:</label>
            <input type="date" class="form-control form-control-lg" id="data_nascimento" name="data_nascimento" value="{{ usuario['data_nascimento'] }}" required>
            <div class="invalid-feedback">Por favor, insira a data de nascimento.</div>
        </div>

        <!-- Endereço -->
        <div class="card p-4 mb-4">
            <h5 class="card-title">Endereço</h5>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="rua" class="form-label">Rua:</label>
                    <input type="text" class="form-control form-control-lg" id="rua" name="rua" value="{{ usuario['endereco'].split(', ')[0] }}" required style="text-transform: uppercase;">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="numero" class="form-label">Número:</label>
                    <input type="text" class="form-control form-control-lg" id="numero" name="numero" value="{{ usuario['endereco'].split(', ')[1] }}" required style="text-transform: uppercase;">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="bairro" class="form-label">Bairro:</label>
                    <input type="text" class="form-control form-control-lg" id="bairro" name="bairro" value="{{ usuario['endereco'].split(', ')[2] }}" required style="text-transform: uppercase;">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="cidade" class="form-label">Cidade:</label>
                    <input type="text" class="form-control form-control-lg" id="cidade" name="cidade" value="{{ usuario['endereco'].split(', ')[3] }}" required style="text-transform: uppercase;">
                </div>
            </div>
        </div>

        <!-- Telefone -->
        <div class="mb-4">
            <label for="telefone" class="form-label">Telefone:</label>
            <input type="tel" class="form-control form-control-lg" id="telefone" name="telefone" value="{{ usuario['telefone'] }}" required>
        </div>

        <!-- Bolsa Família -->
        <div class="mb-4">
            <label class="form-label">Possui Bolsa Família?</label><br>
            <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" id="bolsa_sim" name="bolsa_familia" value="sim" {% if usuario['bolsa_familia'] == 'sim' %}checked{% endif %}>
                <label class="form-check-label" for="bolsa_sim">Sim</label>
            </div>
            <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" id="bolsa_nao" name="bolsa_familia" value="nao" {% if usuario['bolsa_familia'] == 'nao' %}checked{% endif %}>
                <label class="form-check-label" for="bolsa_nao">Não</label>
            </div>
        </div>

        <!-- Última data de retirada da cesta básica -->
        <div class="mb-4">
            <label for="data_cesta" class="form-label">Última data de retirada da cesta básica:</label>
            <input type="date" class="form-control form-control-lg" id="data_cesta" name="data_cesta" value="{{ usuario['data_cesta'] }}">
            <div class="invalid-feedback">Por favor, insira a data de retirada da cesta básica.</div>
        </div>

        <!-- Campo para observações -->
        <div class="mb-4">
            <label for="observacoes" class="form-label">Observações:</label>
            <textarea class="form-control form-control-lg" id="observacoes" name="observacoes" style="text-transform: uppercase;">{{ usuario['observacoes'] or '' }}</textarea>
        </div>

        <!-- Exibição da próxima data de retirada -->
        {% if data_proxima_retirada %}
        <div class="alert alert-info">
            <strong>Próxima retirada da cesta básica:</strong> {{ data_proxima_retirada.strftime('%d/%m/%Y') }}
        </div>
        {% endif %}

        <button type="submit" class="btn btn-primary btn-lg w-100 mb-4">SALVAR ALTERAÇÕES</button>
    </form>

    <!-- Box unificado para edição de filhos e cônjuge -->
    <div class="card card-edit">
        <h4 class="card-title-edit">Editar Informações Familiares</h4>

    <!-- Filhos -->
    {% if filhos %}
    <div class="mb-3">
        <h5 class="card-title-edit">Filhos</h5>
        <ul class="list-group">
            {% for filho in filhos %}
            <li class="list-group-item">
                <span><strong>{{ filho['nome'] }}</strong> - {{ filho['idade'] }} ANOS</span>
                <br> <!-- Adiciona uma quebra de linha para garantir que o botão fique abaixo -->
                <a href="{{ url_for('editar_filho', filho_id=filho['id']) }}" class="btn btn-edit mt-2">EDITAR FILHO</a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Cônjuge -->
    {% if conjuge %}
    <div class="mb-3">
        <h5 class="card-title-edit">Cônjuge</h5>
        <p><strong>{{ conjuge['nome'] }}</strong> - {{ conjuge['data_nascimento'] }}</p>
        <a href="{{ url_for('editar_conjuge', usuario_id=usuario['id']) }}" class="btn btn-edit">EDITAR CÔNJUGE</a>
    </div>
    {% endif %}
</div>

{% endblock %}
