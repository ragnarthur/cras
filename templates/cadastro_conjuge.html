{% extends "base.html" %}

{% block title %}Cadastro de Cônjuge - CRAS App{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4" style="font-size: 2rem; font-weight: bold; letter-spacing: 0.05rem;">Cadastro de Cônjuge</h2>

    <form action="{{ url_for('cadastro_conjuge', usuario_id=usuario_id) }}" method="POST" class="needs-validation form-uppercase" novalidate>
        
        <!-- Box para informações pessoais do cônjuge -->
        <div class="card p-4 mb-4">
            <h5 class="card-title" style="font-size: 1.5rem; font-weight: bold; color: #0d6efd;">Informações Pessoais do Cônjuge</h5>
            <div class="row">
                <!-- Nome do Cônjuge -->
                <div class="col-md-6 mb-3">
                    <label for="nome_conjuge" class="form-label" style="font-size: 1.2rem; font-weight: bold;">Nome do Cônjuge:</label>
                    <input type="text" class="form-control form-control-lg" id="nome_conjuge" name="nome_conjuge" required>
                    <div class="invalid-feedback" style="font-size: 1.1rem;">Por favor, insira o nome do cônjuge.</div>
                </div>

                <!-- Data de Nascimento do Cônjuge -->
                <div class="col-md-6 mb-3">
                    <label for="data_nascimento_conjuge" class="form-label" style="font-size: 1.2rem; font-weight: bold;">Data de Nascimento do Cônjuge:</label>
                    <input type="date" class="form-control form-control-lg" id="data_nascimento_conjuge" name="data_nascimento_conjuge" required>
                    <div class="invalid-feedback" style="font-size: 1.1rem;">Por favor, insira a data de nascimento do cônjuge.</div>
                </div>

                <!-- CPF -->
                <div class="col-md-6 mb-3">
                    <label for="cpf_conjuge" class="form-label" style="font-size: 1.2rem; font-weight: bold;">CPF do Cônjuge:</label>
                    <input type="text" class="form-control form-control-lg" id="cpf_conjuge" name="cpf_conjuge" required>
                    <div class="invalid-feedback" style="font-size: 1.1rem;">Por favor, insira o CPF do cônjuge.</div>
                </div>

                <!-- RG -->
                <div class="col-md-6 mb-3">
                    <label for="rg_conjuge" class="form-label" style="font-size: 1.2rem; font-weight: bold;">RG do Cônjuge:</label>
                    <input type="text" class="form-control form-control-lg" id="rg_conjuge" name="rg_conjuge" required>
                    <div class="invalid-feedback" style="font-size: 1.1rem;">Por favor, insira o RG do cônjuge.</div>
                </div>

                <!-- Campo para idade do cônjuge, preenchido automaticamente -->
                <div class="col-md-6 mb-3">
                    <label for="idade_conjuge" class="form-label" style="font-size: 1.2rem; font-weight: bold;">Idade do Cônjuge:</label>
                    <input type="number" class="form-control form-control-lg" id="idade_conjuge" name="idade_conjuge" readonly>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100">Cadastrar Cônjuge</button>
    </form>
</div>

<!-- Script para calcular a idade automaticamente -->
<script>
    document.getElementById('data_nascimento_conjuge').addEventListener('input', function () {
        const dataNascimento = new Date(this.value);
        const hoje = new Date();
        let idade = hoje.getFullYear() - dataNascimento.getFullYear();
        const mes = hoje.getMonth() - dataNascimento.getMonth();

        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }

        document.getElementById('idade_conjuge').value = idade >= 0 ? idade : '';
    });

    // Máscara para CPF: 111.222.333-44
    function aplicarMascaraCPF(cpf) {
        cpf = cpf.replace(/\D/g, '');
        cpf = cpf.substring(0, 11); // Limita a 11 caracteres numéricos
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d)/, '$1.$2');
        cpf = cpf.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        return cpf;
    }

    // Máscara para RG: 11.222.333
    function aplicarMascaraRG(rg) {
        rg = rg.replace(/\D/g, '');
        rg = rg.substring(0, 8); // Limita a 8 caracteres numéricos
        rg = rg.replace(/(\d{2})(\d)/, '$1.$2');
        rg = rg.replace(/(\d{3})(\d)/, '$1.$2');
        return rg;
    }

    // Aplicando máscaras ao digitar CPF e RG
    document.getElementById('cpf_conjuge').addEventListener('input', function() {
        this.value = aplicarMascaraCPF(this.value);
    });

    document.getElementById('rg_conjuge').addEventListener('input', function() {
        this.value = aplicarMascaraRG(this.value);
    });
</script>

{% endblock %}
