<!-- templates/cadastro_filho.html -->
{% extends "base.html" %}

{% block title %}Cadastro de Filho - CRAS App{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Cadastro de Filho</h2>

    <form action="{{ url_for('cadastro_filho', usuario_id=usuario_id) }}" method="POST" class="needs-validation form-uppercase" novalidate>
        <input type="hidden" name="usuario_id" value="{{ usuario_id }}">
        <div class="mb-4">
            <label for="nome_filho" class="form-label">Nome do Filho:</label>
            <input type="text" class="form-control form-control-lg" id="nome_filho" name="nome_filho" required>
            <div class="invalid-feedback">Por favor, insira o nome do filho.</div>
        </div>

        <div class="mb-4">
            <label for="data_nascimento_filho" class="form-label">Data de Nascimento do Filho:</label>
            <input type="date" class="form-control" id="data_nascimento_filho" name="data_nascimento_filho" required>
            <div class="invalid-feedback">Por favor, insira a data de nascimento do filho.</div>
        </div>

        <!-- Campo para idade do filho, preenchido automaticamente -->
        <div class="mb-4">
            <label for="idade_filho" class="form-label">Idade do Filho:</label>
            <input type="number" class="form-control" id="idade_filho" name="idade_filho" readonly>
        </div>

        <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" id="cadastrar_outro" name="cadastrar_outro" value="sim">
            <label class="form-check-label" for="cadastrar_outro">Cadastrar outro filho?</label>
        </div>

        <button type="submit" class="btn btn-primary btn-lg w-100">Cadastrar Filho</button>
    </form>
</div>

<!-- Script para calcular a idade automaticamente -->
<script>
    document.getElementById('data_nascimento_filho').addEventListener('input', function () {
        const dataNascimento = new Date(this.value);
        const hoje = new Date();
        let idade = hoje.getFullYear() - dataNascimento.getFullYear();
        const mes = hoje.getMonth() - dataNascimento.getMonth();

        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }

        document.getElementById('idade_filho').value = idade >= 0 ? idade : '';
    });
</script>
{% endblock %}
